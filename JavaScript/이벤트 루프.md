# 이벤트 루프 event loop

## 이벤트 루프에 대해서 설명하고, 동시성 모델에 대해서 설명하라.

브라우저에서는 여러가지 것들이 동시에 실행되는 것 같이 보이는데, 이를 동시성이라고 합니다. 자바스크립트 엔진은 한번에 하나의 태스크만 실행하는 싱글 스레드 방식으로 동작합니다. 하지만 브라우저 자체는 멀티 스레드로 동작합니다. 브라우저가 멀티 스레드로 동작하고, 브라우저 내부의 자바스크립트 엔진이 싱글 스레드 방식으로 동작하는 것입니다. 그러므로 동시성을 지원할 수 있습니다. 이러한 동시성은 이벤트 루프가 지원하게 됩니다.

이벤트 루프는 콜 스택에 현재 실행 중인 함수가 있는지 확인하고, 만약 이 콜스택이 비어있으면 태스크 큐에 보관된 비동기 함수의 콜백함수 또는 이벤트 핸들러 함수 등을 순차적으로 콜 스택으로 이동시킵니다.

콜스택에 푸시된 함수들은 순차적으로 실행됩니다.

## call stack과 task queue에 관해 설명해주세요.

콜 스택은 자바스크립트 엔진이 소스코드를 평가하고 실행하기 위한 스택 자료구조입니다.

함수를 호출하면 함수 실행컨텍스트가 콜스택에 푸시되면서 순차적으로 실행됩니다. 자바스크립트 엔진은 싱글 스레드로 단 하나의 콜 스택만 사용하기 때문에 한 번에 하나의 태스크만을 실행합니다.

자바스크립트 엔진은 콜 스택에 태스크가 요청되면 이 작업들을 순차적으로 실행합니다.

태스크 큐는 브라우저나 Node.js 등 자바스크립트 구동 환경에서 제공하는 기능으로, 비동기 함수의 콜백 함수, 이벤트 핸들러 함수 등이 일시적으로 보관되는 영역입니다.

콜 스택에서 실행중인 비동기 함수들이 콜백 함수를 호출 스케줄링하면 브라우저가 호출 스케줄링된 콜백 함수를 태스크 큐에 푸시합니다.

콜 스택에서 실행할 함수가 모두 종료되어 비어있게 되면, 이벤트 루프가 태스크 큐에 있던 콜백 함수 등을 순차적으로 콜 스택에 푸시하게 되고, 콜 스택은 이를 실행합니다.

## 마이크로태스크큐의 목적이 무엇인가요?

마이크로 태스크 큐는 프로미스 후속 처리 메서드의 콜백 함수가 일시적으로 저장됩니다.

일반적인 비동기 함수의 콜백 함수나 이벤트 핸들러가 일시적으로 보관되는 태스크 큐보다 마이크로 태스크 큐가 우선적으로 실행됩니다.

콜 스택이 비어있게 되면 먼저 마이크로태스크 큐에서 대기하고 있는 함수를 실행하고, 그 후에 태스크 큐에 있는 함수들을 실행합니다.

## 스레드란?

스레드는 프로세스 내에서 CPU가 독립적으로 처리하는 하나의 작업 단위입니다. 프로세스 스케줄링의 부담을 최소화하여 시스템의 성능을 극대화하기 위해 사용합니다.

프로세스 간에는 각 프로세스의 데이터 접근이 불가하지만, 스레드는 실행할 수 있는 스택이 각각 하나씩 존재해서, 하나의 프로세스 내에서 여러 개의 스레드를 생성할 수 있습니다. 스레드는 프로세스 안에 있으므로 프로세스의 데이터를 모두 접근할 수 있습니다.

## 싱글 스레드 vs 멀티 스레드 장단점

싱글 스레드와 멀티 스레드 모두 기억장치 상의 heap영역, 정적 영역, 코드 영역이 하나 존재해서 그 영역들을 공유하고 있지만,

싱글 스레드의 경우 프로세스에 하나의 레지스터와 하나의 스택만 가지고 있습니다.

반면 멀티 스레드는 여러 개의 스레드를 이용해서 하나의 프로그램을 동시에 처리할 수 있습니다. 여러개의 스레드를 가지면 각 스레드마다 각각의 레지스터와 스택을 가질 수 있습니다.

멀티 스레드는 각 스레드가 자신이 속한 프로세스의 메모리를 공유하므로 시스템 지원의 낭비가 적고, 하나의 스레드가 작업할 때 다른 스레드가 별도의 작업을 할 수 있어서 사용자와의 응답성도 좋아진다.

다만 멀티 스레딩을 위해 운영체제의 지원이 필요하고, 하나의 스레드만 실행중일 때에는 실행시간이 되려 지연될 수 있다는 단점이 있습니다.

왜냐면 여러 개의 스레드가 공유된 자원을 사용할 경우 각 스레드가 원하는 결과를 얻게 하려면 공용 자원에 대한 접근이 통제되어야 하며 이 작업은 프로그래머에게 많은 노력을 요구하고 비용을 발생시키기 때문입니다.

싱글 스레드의 경우 이런 부분을 신경쓰지 않아도 된다는 장점이 있지만, 여러 개의 CPU를 활용하지 못한다는 단점이 있습니다.

## 자바스크립트는 싱글 스레드 언어이지만 실제 사용시에는 멀티 스레드처럼 사용하는데 어떻게 사용하나요?

자바스크립트 엔진 자체는 싱글 스레드 언어입니다. 하지만 실제로 자바스크립트가 구동되는 환경인 브라우저나 Node.js 같은 경우 멀티 스레드 방식으로 동작하기 때문에, 여러가지 요청을 동시에 해결할 수 있는 것처럼 사용할 수 있습니다.

이러한 동시성을 지원하기 위해 이벤트 루프라는 것을 사용합니다.

이벤트 루프는 자바스크립트 엔진이 소스코드를 평가하고 실행하는 콜스택과 브라우저의 태스크 큐의 상호작용을 위해서 존재합니다.

자바스크립트 엔진은 전체 소스코드를 평가하고 콜 스택에 전역과 함수 실행 컨텍스트를 푸시하면서 소스코드를 실행합니다. 이때 만약 비동기 함수의 콜백 함수나 이벤트 함수같이 호출 스케줄링이 필요한 함수가 존재한다면, 브라우저에서는 이 함수들을 태스크큐에 보관합니다. 태스크 큐에 보관된 함수들은 콜스택이 비게 되면 이벤트 루프에 의해 콜 스택으로 푸시되고 실행됩니다. 이때 태스크 큐는 선입선출 방식으로 동작해 먼저 들어온 함수부터 콜스택으로 푸시하게 됩니다.
